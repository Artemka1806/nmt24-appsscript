<!DOCTYPE html>
<html>

<head>
  <base target="_top">
  <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
  <!-- https://developers.google.com/apps-script/add-ons/guides/css -->
</head>

<body>
  <style>
    body {
      padding: 0px 10px;
    }

    h1 {
      margin: 2px
    }

    .button {
      margin: 2px;
      margin-left: 0px;
      text-align: left;
      width: 180px;
      padding-left: 5px;
    }

    #templates {
      display: flex;
      flex-direction: column;
    }

    tasks-count {
      display: flex;
      flex-direction: row;
    }

    input[type="number"] {
      width: 40px;
    }

    select {
      text-align: left;
      width: 200px
    }

    #plashka {
      position: absolute;
      z-index: 100;
      width: 100%;
      height: 100%;
      border: none;
      background-color: #303030;
      color: darkgrey;
      opacity: 95%
    }

    .modal-header {
      color: #fff;
      font-weight: bold;
    }

    span {
      color: white;
      font-weight: norma;
      /* margin-bottom: 20px; */
    }
  </style>

  <dialog class="share plashka-hide" id='plashka'>
    <h2 class="modal-header">–°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞—Ü—é—î! –û—á—ñ–∫—É–π—Ç–µ!<h2>
        <img src = "https://i.pinimg.com/originals/ec/05/32/ec0532d0a6db947f62f0daf02e8921d9.gif" style="width: 250px;">
        <span>‚¨Ü –®–∞—Ç–∫—ñ–≤—Å—å–∫–∏–π</span>
        <img src = "https://media1.tenor.com/m/bCfpwMjfAi0AAAAC/cat-typing.gif" style="width: 250px;">
        <span>‚¨Ü –ì–µ—Ä–∞—Å–∏–º—á—É–∫</span>
        <img src = "https://media0.giphy.com/media/JIX9t2j0ZTN9S/200w.gif?cid=6c09b952ejqheyxyxyrn98e7u8mfjgo66z9c4lxr44m6781t&ep=v1_gifs_search&rid=200w.gif&ct=g" style="width: 250px;">
        <span>‚¨Ü –¢–∏—â–µ–Ω–∫–æ</span>


  </dialog>

  <fieldset>
    <legend>–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö</legend>
    <div>
      <button class="action button" onclick="saveToDB()" id ='saveData'>üöÄ –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –≤ –±–∞–∑—É –¥–∞–Ω–∏—Ö</button>
    </div>
    <div>
      <button class="action button" onclick="saveSettings()" id ='saveSettings'>üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</button>
    </div>
  </fieldset>

  <fieldset>
    <legend>–ü—Ä–µ–¥–º–µ—Ç</legend>
    <div>
      <? var subjects = NMTparserlib.getSubjects(); ?>
      <? var subject = NMTparserlib.getSubject(); ?>
      <select id="subjects">
        <? for (var i = 0; i < subjects.length; i++) { ?>
          <? if (subject == i) { ?>
              <option selected>
                <?= subjects[i] ?>
            </option>
            <? } else  { ?>
              <option>
                <?= subjects[i] ?>
            </option>
            <? } ?>
        <? } ?>      
      </select>
    </div>
  </fieldset>



  <fieldset>
    <legend>–°—Ç–∞—Ç—É—Å</legend>

    <? var status = NMTparserlib.getStatus() ?>
    <? if (status == true) { ?>
    <div>
      <input type="radio" id="active" name="status" value="true" checked />
      <label for="active">–î–æ—Å—Ç—É–ø–Ω–∏–π –¥–ª—è –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è</label>
    </div>
    <div>
      <input type="radio" id="passive" name="status" value="false" />
      <label for="passive">–ù–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π –¥–ª—è –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è</label>
    </div>
    <? } else if (status == false)  { ?>
    <div>
      <input type="radio" id="active" name="status" value="true" />
      <label for="active">–î–æ—Å—Ç—É–ø–Ω–∏–π –¥–ª—è –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è</label>
    </div>
    <div>
      <input type="radio" id="passive" name="status" value="false" checked />
      <label for="passive">–ù–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π –¥–ª—è –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è</label>
    </div>
    <? } ?>
  </fieldset>

  <fieldset>
    <legend>–¢–∏–ø —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è</legend>

    <? var type = NMTparserlib.getType(); ?>
    <? if (type == 1) { ?>
    <div>
      <input type="radio" id="active" name="type" value="1" checked />
      <label for="active">–ü—Ä–æ–±–Ω–µ –ù–ú–¢</label>
    </div>
    <div>
      <input type="radio" id="passive" name="type" value="0" />
      <label for="passive">–ù–∞–≤—á–∞–ª—å–Ω–∏–π —Ç–µ—Å—Ç</label>
    </div>
    <? } else  { ?>
    <div>
      <input type="radio" id="active" name="type" value="1" />
      <label for="active">–ü—Ä–æ–±–Ω–µ –ù–ú–¢</label>
    </div>
    <div>
      <input type="radio" id="passive" name="type" value="0" checked />
      <label for="passive">–ù–∞–≤—á–∞–ª—å–Ω–∏–π —Ç–µ—Å—Ç</label>
    </div>
    <? } ?>
  </fieldset>

  <fieldset>
    <legend>–ß–∞—Å –Ω–∞ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è (–≤ —Ö–≤–∏–ª–∏–Ω–∞—Ö)</legend>
    <? var time = NMTparserlib.getTime(); ?>

    <div class="time">
      <input type="number" id="time" style="width: 100px;" value = <?= time ?>>
    </div>

  </fieldset>

  <fieldset>
    <legend>–î–æ–¥–∞—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è:</legend>
    <? var templates = NMTparserlib.getTemplates(); ?>
    <div id="templates">
      <? for (var i = 0; i < templates.length; i++) { ?>
      <div class="tasks-count">
        <button class="button" onclick = "s( <?= templates[i] ?>,<?= i ?>)" >
          <?= templates[i] ?>
        </button>
        <input type="number" id="numericInput<?= i?>" name="quantity" min="1" max="50" step="1" value="1">

      </div>
      <? } ?>
    </div>
    <div>
      <button class="share button" onclick="renumerateTasks()" id ='save'>üî¢ –ü—Ä–æ–Ω—É–º–µ—Ä—É–≤–∞—Ç–∏</button>
    </div>

  </fieldset>

  <fieldset>
    <legend>–û—á–∏—Å—Ç–∫–∞</legend>

    <div>
      <button class="create button" onclick="clearAll()" id ='clearAll'>‚ùå –û—á–∏—Å—Ç–∏—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç</button>
    </div>
  </fieldset>


  <fieldset>
    <legend>–°–∞–π—Ç</legend>
    <div>
      <button class="action button" onclick="window.open('https://shatvm.github.io/nmt24')">–°–∞–π—Ç nmt24 (github + render)</button>
    </div>

    <div>
      <button class="button" onclick="window.open('https://dev-validator.ztu.edu.ua/nmt24/nmt-client/index.html')">–°–∞–π—Ç nmt24 (virtual server)</button>
    </div>
  </fieldset>

  <details>
    <summary style="color: #fff">–î–ª—è —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞</summary>
    <div>
      <button class="action" onclick="google.script.run.withSuccessHandler(onSuccess).evalLibFunction('TestDataManagerRemoveCache');">–í–∏–¥–∞–ª–∏—Ç–∏ –∫–µ—à –¥–æ–∫—É–º–µ–Ω—Ç—É</button>
      <button class="action" onclick="google.script.run.withSuccessHandler(onSuccess).evalLibFunction('TestDataManagerCacheAlert');">–û—Ç—Ä–∏–º–∞—Ç–∏ –∫–µ—à –¥–æ–∫—É–º–µ–Ω—Ç—É</button>
    </div>
    <hr>
    <div>
      <button class="action" onclick="google.script.run.withSuccessHandler(onSuccess).evalLibFunction('allTestsVisible')">–ó—Ä–æ–±–∏—Ç–∏ –í–°–Ü –¥–æ–∫—É–º–µ–Ω—Ç–∏ –≤–∏–¥–∏–º–∏–º–∏</button>
      <button class="action" onclick="google.script.run.withSuccessHandler(onSuccess).evalLibFunction('allTestsInisible')">–ó—Ä–æ–±–∏—Ç–∏ –í–°–Ü –¥–æ–∫—É–º–µ–Ω—Ç–∏ –Ω–µ–≤–∏–¥–∏–º–∏–º–∏</button>
    </div>
  </details>


  <!-- <? function count(){
          return document.getElementById('numericInput').value}?> -->


  <script>
    function onSuccess(){
      var plashkaElement = document.getElementById('plashka');
      plashkaElement.close();
    }

    function onFailure(){
      var plashkaElement = document.getElementById('plashka');
      plashkaElement.close();
      alert("–í–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞!");
    }

    function saveSettings(){
      let subject = document.getElementById("subjects").selectedIndex;
      console.log(subject)

      let status;
      let statusElement = document.querySelector('input[name="status"]:checked');
      if (statusElement.value == "true"){
        status = true;
      } else if (statusElement.value == "false"){
        status = false;
      }

      let type = parseInt(document.querySelector( 'input[name="type"]:checked').value);

      let time = parseInt(document.getElementById('time').value);

      let argumentsString = `${subject}, ${status}, ${type}, ${time}`
      console.log(argumentsString)
      document.getElementById('plashka').show();
      google.script.run.withFailureHandler(onFailure).withSuccessHandler(onSuccess).evalLibFunction("saveSettings", argumentsString)
    }

    //[START] –í—Å—Ç–∞–≤–ª–µ–Ω–Ω—è —à–∞–±–ª–æ–Ω—É –≤–∏–∑–Ω–∞—á–µ–Ω—É –ª—ñ—á–∏–ª—å–Ω–∏–∫–æ–º –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ä–∞–∑—ñ–≤ 
    async function s(name,templateIndex) {
    // –†–µ–∫—É—Ä—Å–∏–≤–Ω–∏–π –≤–∏–∫–ª–∏–∫ —Ñ—É–Ω–∫—Ü—ñ—ó
    var plashkaElement = document.getElementById('plashka');
      plashkaElement.showModal()
    async function recursiveCall(counter) {
      
        // –ë–∞–∑–æ–≤–∏–π –≤–∏–ø–∞–¥–æ–∫: —è–∫—â–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫ –¥–æ—Ä—ñ–≤–Ω—é—î 0, –∑–∞–≤–µ—Ä—à—É—î–º–æ —Ä–µ–∫—É—Ä—Å—ñ—é
        if (counter === 0) {
            console.log("–í—Å—ñ –≤–∏–∫–ª–∏–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–æ");
            document.getElementById('numericInput' + templateIndex).value = 1;
            var plashkaElement = document.getElementById('plashka');
            plashkaElement.close()
            //–º–æ–¥–∞–ª–∫–∞
            return;
        }

        // –í–∏–∫–ª–∏–∫–∞—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é
        console.log(`–í–∏–∫–ª–∏–∫ —Ñ—É–Ω–∫—Ü—ñ—ó ${counter}`);
        document.getElementById('numericInput' + templateIndex).value = counter
        await asyncFunction(name);

        // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –≤–∏–∫–ª–∏–∫–∞—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é –∑ –ª—ñ—á–∏–ª—å–Ω–∏–∫–æ–º, –∑–º–µ–Ω—à–µ–Ω–∏–º –Ω–∞ 1
        await recursiveCall(counter - 1);
    }

    // –í–∏–∫–ª–∏–∫–∞—î–º–æ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é –∑—ñ –∑–Ω–∞—á–µ–Ω–Ω—è–º –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞
    await recursiveCall(document.getElementById('numericInput'+templateIndex).value);
    }

    async function asyncFunction(name) {
      return new Promise(resolve => {
        // –ü—Å–µ–≤–¥–æ–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è (—Ç–∞–π–º–∞—É—Ç 3 —Å–µ–∫—É–Ω–¥–∏)
        setTimeout(() => {
          google.script.run.withUserObject(this).evalLibFunction("pTemplate", '"'+name+'"');
            console.log("–§—É–Ω–∫—Ü—ñ—è –≤–∏–∫–æ–Ω–∞–Ω–∞");
            resolve();
        }, 3000);
      });
    }

    // [END]---

    function saveToDB(){
      var plashkaElement = document.getElementById('plashka');
      plashkaElement.showModal()
      google.script.run.withFailureHandler(onFailure).withSuccessHandler(onSuccess).evalLibFunction("main")
    }

    function renumerateTasks(){
      var plashkaElement = document.getElementById('plashka');
      plashkaElement.showModal()
      google.script.run.withFailureHandler(onFailure).withSuccessHandler(onSuccess).evalLibFunction("numerateQuestion")
    }

    function clearAll(){
      alert('–î–æ–∫—É–º–µ–Ω—Ç –±—É–¥–µ –æ—á–∏—â–µ–Ω–æ –ø–æ–≤–Ω—ñ—Å—Ç—é "OK" –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è ')
      alert('–û—á–∏—Å—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç—É "OK" –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è ')
      var plashkaElement = document.getElementById('plashka');
      plashkaElement.showModal()
      google.script.run.withFailureHandler(onFailure).withSuccessHandler(onSuccess).evalLibFunction("clearAll")
    }

  //
    
  </script>
</body>

</html>